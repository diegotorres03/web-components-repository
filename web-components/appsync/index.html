<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <link rel="stylesheet" href="../style-tools.css">
    <link rel="stylesheet" href="../css-tools.css">


    <script src="../package-bundle.js"></script>
    <script src="../web-tools.js"></script>
    
    <script src="../modal/components/modal.component.js"></script>
    <script src="./appsync.component.js"></script>
    <script src="./appsync-mutation.component.js"></script>
    <script src="./appsync-subscription.component.js"></script>

</head>
<body>


    <app-sync url="https://rk3ugzaxgbbnhktxogj2wkgnke.appsync-api.us-west-2.amazonaws.com/graphql" key="da2-xddv5ajstrgyrfuxqnjot5fusi" >
        
        <app-sync-subscription id="session-subscription" >
            subscription MySubscription {
                onCreateSession {
                  id
                  level
                  recordType
                }
              }              
        </app-sync-subscription>

        <app-sync-mutation id="create-session" >
            mutation MyMutation {
                createSession(id: {id: "$id", level: "$level", recordType: "$recordType"}) {
                  id
                  level
                  recordType
                }
              }              
        </app-sync-mutation>
        
    </app-sync>


    
    <app-modal id="subscribtion-modal" trigger="#session-subscription" trigger-event="data">
        <section id="subscription-content" slot="main"></section>        
    </app-modal>
        

    <script>
        const subs = document.querySelector('#session-subscription')
        const mutation = document.querySelector('#create-session')
        const modalContent = document.querySelector('#subscription-content')
        
        setTimeout(() => {
            // subs.subscribe(ev => console.log(ev))
            subs.addEventListener('data', ev => {
                const session = ev.detail.onCreateSession
                console.log(session)
                modalContent.textContent = JSON.stringify(session, undefined, 2)

            })
            mutation.post({id: 7, level: 10, recordType: 'test-t-cle'})

        }, 300)


    </script>
    
</body>
</html>