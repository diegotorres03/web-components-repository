<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <style>
    .hidden {
      display: none;
    }
  </style>

  <script id="transforms-and-filters">
    const filters = Object.freeze({
      test(event, param) {
        console.log(event, param)
        return event.detail
      },
      hasSessionToken(event) {
        console.clear()
        console.log('on hasSessionToken', event)
        return true
      }

    })

    // localhost:8080/#admin?token=asdasd
    const transforms = Object.freeze({
      count(data, direction = 1) {
        console.log(data, direction)
        const { id, name, count } = data
        return { id, name, count: Date.now() % 100 }
        // return { id, name, count: Number(count) + Number(direction) }
      },
      getTokenFromUrl(event) {
        console.log('on getTokenFromUrl', event)
        alert('test')
        const [hash, query] = window.location.hash.split('?')
        if(!query) return null
        const search = new URLSearchParams(query)
        return search.get('token')

      }
    })
  </script>



  <!-- Session management -->
  <!-- <event-source id="" trigger="window" event="load" filter="hasSessionToken"  /> -->
  
  <app-modal trigger="#get-token-from-url" event="loaded"></app-modal>
  <event-source id="get-token-from-url" trigger="window" event="load" transform="getTokenFromUrl"/>
  
  <data-store id="user-session">
    <data-set id="browser-token" visible></data-set>
    <data-set id="user-token" trigger="#get-token-from-url" event="data"></data-set>
  </data-store>
  
  <!-- /Session management -->

  <app-router>

    <app-route>
      <h1>hi</h1>
      <nav>
        <a href="#rooms">rooms</a>
        <a href="#admin">admin</a>
        <a href="#login">login</a>
      </nav>
    </app-route>

    <!-- <app-route></app-route> -->
    <app-route hash="login">
      <nav>
        <a href="#rooms">rooms</a>
        <a href="#admin">admin</a>
        <a href="#login">login</a>
      </nav>
      <hr>
      <app-modal id="login-modal" open>
        <section slot="main">
          <form>
            <label for="">Alias: </label><input type="text" name="alias">
          </form>
        </section>
      </app-modal>

      <style>
        flip-card {
          width: 200px;
          height: 300px;
        }
      </style>

      <!-- <deck-reader>
        <flip-card>
          <h1 slot="front">front 1</h1>
        </flip-card>
        <flip-card>
          <h1 slot="front">front 2</h1>
        </flip-card>
        <flip-card>
          <h1 slot="front">front 3</h1>
        </flip-card>
        <flip-card>
          <h1 slot="front">front 4</h1>
        </flip-card>
      </deck-reader> -->

    </app-route>



    <!-- <app-route></app-route> -->
    <app-route hash="rooms">

      <h1>rooms</h1>
      <nav>
        <a href="#rooms">rooms</a>
        <a href="#admin">admin</a>
        <a href="#login">login</a>
      </nav>

      <hr>
      <style>
        /* .grid {
          display: grid;
          grid-template-columns: 50% 50%;
          grid-template-rows: 50% 50%;
          gap: 40px;
        } */
      </style>

      <section class="flex-column">
        <plain-card style="width: 90vh;">
          <h1 slot="title">Main Room <span data-key="id" data-attribute="textContent"></span></h1>
          <section slot="main" style="text-align: center;">
            <small>this room is visible to everybody and it will be the starting point of the conversation</small>
            <br>
            <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
          </section>
        </plain-card>
      </section>


      <ui-data-repeat class="grid" id="ui-rooms-list" trigger="#event-info-changed" event="data">
        <template>
          <plain-card>
            <h1 slot="title"><span name="name"></span></h1>
            <section slot="main">
              <b>hosted by:</b><span name="alias"></span>
              <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
            </section>
          </plain-card>
        </template>
      </ui-data-repeat>


      <!-- <section class="grid">

        <flip-card>
          <section slot="front">
            <h1>Room <span data-key="id" data-attribute="textContent"></span></h1>
            <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
          </section>
        </flip-card>

        <flip-card disabled>
          <section slot="front">
            <h1>Room <span data-key="id" data-attribute="textContent"></span></h1>
            <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
          </section>
        </flip-card>

        <flip-card disabled>
          <section slot="front">
            <h1>Room <span data-key="id" data-attribute="textContent"></span></h1>
            <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
          </section>
        </flip-card>

        <flip-card>
          <section slot="front">
            <h1>Room <span data-key="id" data-attribute="textContent"></span></h1>
            <a data-key="url" data-attribute="href" href="" target="_blank">chime link</a>
          </section>
        </flip-card>

      </section> -->
      <!-- <app-accordion>
        <section>
          <h1>Main room</h1>
          <p>This will be the room for the main presentation before going to breakout sessions.</p>
        </section>
      </app-accordion>

      <app-accordion>
        <section>
          <h1>Room 12</h1>
          <p>This room has been designated for me by a random hash.</p>
        </section>
      </app-accordion> -->

    </app-route>

    <!-- <app-route></app-route> -->
    <app-route hash="admin">

      <app-layout>
        <h1 slot="header">admin</h1>
        <nav slot="top-menu">
          <a href="#rooms">rooms</a>
          <a href="#admin">admin</a>
          <a href="#login">login</a>
        </nav>
        <h2 slot="left-header">Events</h2>
        <section slot="left-content">
          <app-accordion>
            <section>
              <h1>CDK Event</h1>
              <p>This will be the room for the main presentation before going to breakout sessions.</p>
            </section>

            <section>
              <h1>Other</h1>
              <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eos repellendus asperiores quas recusandae
                doloribus non qui libero. Unde autem iure velit voluptates alias tenetur temporibus, asperiores fugit
                quis assumenda praesentium!</p>
            </section>
          </app-accordion>
          <hr>
          <app-accordion>
            <section>
              <h1>other info</h1>
              <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Recusandae, cum! Dolores quia repudiandae
                autem, error voluptatem similique odit animi laudantium sunt. Ducimus eum earum labore? Odio quod
                reiciendis fugit quaerat adipisci ullam asperiores reprehenderit, minus unde sed quos harum tenetur ipsa
                ipsum aliquid molestias impedit eos necessitatibus atque. Nemo velit tempora voluptate eum commodi odio
                perferendis quasi numquam ex odit? Sint nemo fugiat similique dignissimos voluptatibus commodi iure
                nulla corrupti blanditiis? Iusto ratione voluptates commodi quisquam quaerat nostrum eveniet earum
                beatae qui eligendi laborum fugit officia rerum nemo distinctio nesciunt harum, dignissimos suscipit
                consequuntur amet consequatur accusantium. Doloremque, magnam possimus?</p>
            </section>

            <section>
              <h1>Other</h1>
              <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eos repellendus asperiores quas recusandae
                doloribus non qui libero. Unde autem iure velit voluptates alias tenetur temporibus, asperiores fugit
                quis assumenda praesentium!</p>
            </section>

            <section>
              <h1>Other</h1>
              <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eos repellendus asperiores quas recusandae
                doloribus non qui libero. Unde autem iure velit voluptates alias tenetur temporibus, asperiores fugit
                quis
                assumenda praesentium!</p>
            </section>

            <section>
              <h1>Other</h1>
              <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eos repellendus asperiores quas recusandae
                doloribus non qui libero. Unde autem iure velit voluptates alias tenetur temporibus, asperiores fugit
                quis
                assumenda praesentium!</p>
            </section>
          </app-accordion>
        </section>

        <section slot="main">
          <article>
            <h1>TODO</h1>
            <input type="checkbox" name="" id=""><label>create event if none present</label><br>
            <input type="checkbox" name="" id=""><label>dysplay basic event info</label><br>
            <input type="checkbox" name="" id=""><label>add rooms</label><br>
          </article>


          <hr>
          <br>
          <br>
          <br>
          <br>
          <article id="room table">

            <table>

              <thead>
                <tr>
                  <th>name</th>
                  <th>url</th>
                  <th>host</th>
                  <th>date</th>
                </tr>
              </thead>

            </table>

            <hr>

            <ui-data-sync trigger="#event-info-changed" event="data">
              <div>
                <span name="name"><i>Room Name</i></span>
                <span name="url" data-attribute="href"><a href="https://chime.aws/1234">URL</a></span>
                <span name="host"><i>Host Alias</i></span>
                <span name="facilitator"><i>Facilitator Alias</i></span>
                <span name="date"><i>Date and Time of the event</i></span>
              </div>
            </ui-data-sync>

            <br>
            <hr>
            <br>
            <hr>
            <br>

            <ui-data-repeat id="ui-rooms-list" trigger="#event-info-changed" event="data">
              <template>
                <div>
                  <span name="name">Main Room</span>
                  <span name="url" data-attribute="href"><a href="https://chime.aws/1234">URL</a></span>
                  <span name="host">Chandra Reddy</span>
                  <span name="date">April 20 - 2023 at 3:00 pm</span>
                  <button name="edit">✏️</button>
                  <button name="delete">🗑️</button>
                </div>
              </template>
            </ui-data-repeat>


            <app-modal id="confirm-delete-room-modal" trigger="#ui-rooms-list" event="delete">
              <h1 slot="title">You are about to delete this room</h1>
              <p slot="main">Room <b data-key="name"></b> will be deleted.</p>
            </app-modal>

            <br>
            <hr>
            <br>

            <button id="add-room-btn">add room</button>

            <event-group id="open-event-modal">
              <event-source trigger="#add-room-btn" action="click" />
              <event-source trigger="#ui-rooms-list" event="edit" />
            </event-group>


            <app-modal id="new-room-modal" trigger="#open-event-modal" event="data">
              <!-- <app-modal id="new-room-modal" trigger="#on-load-event" action="loaded"> -->

              <form slot="main">
                <label for="">Room Name</label><input type="text" name="name"><br>
                <label for="">Room url</label><input type="text" name="url"><br>
                <label for="">Host</label><input type="text" name="host"><br>
                <label for="">Facilitator</label><input type="text" name="alias"><br>
                <label for="">date</label><input type="date" name="date"><br>
              </form>
            </app-modal>

            <!-- <app-modal trigger="#on-load-event" event="loaded"></app-modal> -->
            <!-- <app-modal trigger="#get-current-event" event="get"></app-modal> -->

            <event-source id="on-load-event" trigger="window" event="load" />

            <event-group id="event-info-changed">
              <event-source trigger="#get-current-event" event="list" />
              <event-source trigger="#room-list" event="updated" />

            </event-group>

            <hr>
            <br>
            <br>
            <br>
            <br>

            <data-store id="room-store">
              <data-set visible id="room-list" trigger="#new-room-modal" event="accepted" append visible>
                <data-query id="delete-room-query" key="room-list" type="delete" trigger="#confirm-delete-room-modal"
                  event="accepted"></data-query>
                <data-query id="get-current-event" key="room-list" type="list" trigger="#on-load-event"
                  event="loaded"></data-query>
              </data-set>
            </data-store>

          </article>

        </section>

      </app-layout>

    </app-route>

  </app-router>


</body>

</html>