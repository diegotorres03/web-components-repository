<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PoC</title>
</head>

<body>
  <script>
    const counter = {
      green: 0,
      yellow: 0,
      red: 0,
    }
    const actions = Object.freeze({
      delay1: () => {
        return new Promise(resolve => {
          setTimeout(() => {
            console.log('delay1')
            resolve({ emit: 'delay4' })
          }, 2000)
        })
      },
      delay2: () => {
        return new Promise(resolve => {

          setTimeout(() => {
            console.log('delay2')
            resolve({ emit: 'delay5' })
          }, 2000)
        })
      },
      delay3: () => {
        return new Promise(resolve => {
          setTimeout(() => {
            console.log('delay3')
            resolve({ emit: 'delay6' })
          }, 2000)
        })
      },
    })
  </script>

  <state-machine visible id="traffic-lights-machine" initial-state="green">
    <machine-state id="green" >
      <machine-transition trigger="#green-btn" on="click" emit="delay4" target="yellow" action="log"></machine-transition>
    </machine-state>
    <machine-state id="yellow" action="delay2">
      <machine-transition trigger="#yellow-btn" on="click" emit="delay5" target="red"></machine-transition>
    </machine-state>
    <machine-state id="red" action="delay3">
      <machine-transition trigger="#red-btn" on="click" emit="delay6" target="green"></machine-transition>
    </machine-state>

  </state-machine>

  <button id="green-btn">green</button>
  <button id="yellow-btn">yellow</button>
  <button id="red-btn">red</button>

  <flip-card disabled trigger="#traffic-lights-machine" on="green">
    <section slot="front">
      idle
    </section>
    <section slot="back">
      green
    </section>

  </flip-card>
  <flip-card disabled trigger="#traffic-lights-machine" on="yellow">
    <section slot="front">
      idle
    </section>
    <section slot="back">
      yellow
    </section>
  </flip-card>
  <flip-card disabled trigger="#traffic-lights-machine" on="red">
    <section slot="front">
      idle
    </section>
    <section slot="back">
      red
    </section>
  </flip-card>

  <script>

    const machine = document.querySelector('state-machine')

    machine.addEventListener('stateChanged', event => {
      console.log('stateChanged', event.detail.state)
      // console.log('state', state.value)
    })


  </script>
</body>

</html>